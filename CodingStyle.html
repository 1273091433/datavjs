<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>datavjs Documentation</title>
    <meta name="keywords" content="DataV" />
    <meta name="description" content="DataV.js is a JavaScript library for data visualization" />
    <script src="assets/prettify.js"></script>
    <script src="assets/jquery-1.8.2.min.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" type="text/css" href="assets/base.css" />
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="./index.html">datavjs</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
            
              <li>
                <a href="./api.html">API Docs</a>
              </li>
            
              <li>
                <a href="./Architecture.html">Architecture</a>
              </li>
            
              <li>
                <a href="./CodingStyle.html">CodingStyle</a>
              </li>
            
              <li>
                <a href="./dataFormat.html">dataFormat</a>
              </li>
            
              <li>
                <a href="./DataV_Introduction.html">DataV_Introduction</a>
              </li>
            
              <li>
                <a href="./chord文档.html">chord文档</a>
              </li>
            
              <li>
                <a href="./Getting Start.html">Getting Start</a>
              </li>
            
            
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">更多 <b class="caret"></b></a>
                <ul class="dropdown-menu" role="menu">
                
                  <li>
                    <a href="./Load DataV.html">Load DataV</a>
                  </li>
                
                  <li>
                    <a href="./parallel文档.html">parallel文档</a>
                  </li>
                
                  <li>
                    <a href="./Pie文档.html">Pie文档</a>
                  </li>
                
                  <li>
                    <a href="./radar文档.html">radar文档</a>
                  </li>
                
                  <li>
                    <a href="./changelog.html">changelog</a>
                  </li>
                
                  <li>
                    <a href="./stream文档.html">stream文档</a>
                  </li>
                
                  <li>
                    <a href="./butterfly.html">butterfly</a>
                  </li>
                
                  <li>
                    <a href="./treemap文档.html">treemap文档</a>
                  </li>
                
                  <li>
                    <a href="./bullet文档.html">bullet文档</a>
                  </li>
                
                  <li>
                    <a href="./服务器配置.html">服务器配置</a>
                  </li>
                
                  <li>
                    <a href="./force文档.html">force文档</a>
                  </li>
                
                </ul>
              </li>
            
            </ul>
          </div>
        </div>
      </div>
    </div>
    <header class="jumbotron subhead">
      <div class="container">
        <h1>datavjs <small>Version: 0.1.1 By @DataV</small></h1>
        <p class="lead">
          DataV.js is a JavaScript library for data visualization
        </p>
      </div>
    </header>
<div class="container content">
  <div class="row">
  	<div class="span3 bs-docs-sidebar">
      <ul class="nav nav-list bs-docs-sidenav affix">

  <li class="level_1">
    <a href="#index_DataV项目编码规范" title="DataV项目编码规范">
      <i class="icon-chevron-right"></i>DataV项目编码规范
    </a>
  </li>

  <li class="level_2">
    <a href="#index_命名空间" title="命名空间">
      <i class="icon-chevron-right"></i>命名空间
    </a>
  </li>

  <li class="level_2">
    <a href="#index_语法" title="语法">
      <i class="icon-chevron-right"></i>语法
    </a>
  </li>

  <li class="level_3">
    <a href="#index_缩进规范" title="缩进规范">
      <i class="icon-chevron-right"></i>缩进规范
    </a>
  </li>

  <li class="level_3">
    <a href="#index_空格" title="空格">
      <i class="icon-chevron-right"></i>空格
    </a>
  </li>

  <li class="level_3">
    <a href="#index_分号" title="分号">
      <i class="icon-chevron-right"></i>分号
    </a>
  </li>

  <li class="level_3">
    <a href="#index_大括号" title="大括号">
      <i class="icon-chevron-right"></i>大括号
    </a>
  </li>

  <li class="level_2">
    <a href="#index_命名规范" title="命名规范">
      <i class="icon-chevron-right"></i>命名规范
    </a>
  </li>

  <li class="level_3">
    <a href="#index_变量" title="变量">
      <i class="icon-chevron-right"></i>变量
    </a>
  </li>

  <li class="level_3">
    <a href="#index_方法" title="方法">
      <i class="icon-chevron-right"></i>方法
    </a>
  </li>

  <li class="level_3">
    <a href="#index_类" title="类">
      <i class="icon-chevron-right"></i>类
    </a>
  </li>

  <li class="level_3">
    <a href="#index_模块" title="模块">
      <i class="icon-chevron-right"></i>模块
    </a>
  </li>

  <li class="level_2">
    <a href="#index_注释" title="注释">
      <i class="icon-chevron-right"></i>注释
    </a>
  </li>

  <li class="level_2">
    <a href="#index_文件名（以及目录）" title="文件名（以及目录）">
      <i class="icon-chevron-right"></i>文件名（以及目录）
    </a>
  </li>

  <li class="level_2">
    <a href="#index_JSLint扫描代码" title="JSLint扫描代码">
      <i class="icon-chevron-right"></i>JSLint扫描代码
    </a>
  </li>

  <li class="level_2">
    <a href="#index_目录结构说明" title="目录结构说明">
      <i class="icon-chevron-right"></i>目录结构说明
    </a>
  </li>

  <li class="level_2">
    <a href="#index_单元测试" title="单元测试">
      <i class="icon-chevron-right"></i>单元测试
    </a>
  </li>

  <li class="level_2">
    <a href="#index_数据格式" title="数据格式">
      <i class="icon-chevron-right"></i>数据格式
    </a>
  </li>

  <li class="level_2">
    <a href="#index_事件注入" title="事件注入">
      <i class="icon-chevron-right"></i>事件注入
    </a>
  </li>

  <li class="level_2">
    <a href="#index_常见错误" title="常见错误">
      <i class="icon-chevron-right"></i>常见错误
    </a>
  </li>

  <li class="level_3">
    <a href="#index_判断一个对象是否是数组" title="判断一个对象是否是数组">
      <i class="icon-chevron-right"></i>判断一个对象是否是数组
    </a>
  </li>

  <li class="level_3">
    <a href="#index_数组去重" title="数组去重">
      <i class="icon-chevron-right"></i>数组去重
    </a>
  </li>

  <li class="level_3">
    <a href="#index_元素是否存在数组中" title="元素是否存在数组中">
      <i class="icon-chevron-right"></i>元素是否存在数组中
    </a>
  </li>

  <li class="level_3">
    <a href="#index_meta" title="meta">
      <i class="icon-chevron-right"></i>meta
    </a>
  </li>

  <li class="level_3">
    <a href="#index_script标签的type属性" title="script标签的type属性">
      <i class="icon-chevron-right"></i>script标签的type属性
    </a>
  </li>

  <li class="level_1">
    <a href="#index_" title="">
      <i class="icon-chevron-right"></i>
    </a>
  </li>

  <li class="level_1">
    <a href="#index_DataV项目编码规范" title="DataV项目编码规范">
      <i class="icon-chevron-right"></i>DataV项目编码规范
    </a>
  </li>

  <li class="level_2">
    <a href="#index_命名空间" title="命名空间">
      <i class="icon-chevron-right"></i>命名空间
    </a>
  </li>

  <li class="level_2">
    <a href="#index_语法" title="语法">
      <i class="icon-chevron-right"></i>语法
    </a>
  </li>

  <li class="level_3">
    <a href="#index_缩进规范" title="缩进规范">
      <i class="icon-chevron-right"></i>缩进规范
    </a>
  </li>

  <li class="level_3">
    <a href="#index_空格" title="空格">
      <i class="icon-chevron-right"></i>空格
    </a>
  </li>

  <li class="level_3">
    <a href="#index_分号" title="分号">
      <i class="icon-chevron-right"></i>分号
    </a>
  </li>

  <li class="level_3">
    <a href="#index_大括号" title="大括号">
      <i class="icon-chevron-right"></i>大括号
    </a>
  </li>

  <li class="level_2">
    <a href="#index_命名规范" title="命名规范">
      <i class="icon-chevron-right"></i>命名规范
    </a>
  </li>

  <li class="level_3">
    <a href="#index_变量" title="变量">
      <i class="icon-chevron-right"></i>变量
    </a>
  </li>

  <li class="level_3">
    <a href="#index_方法" title="方法">
      <i class="icon-chevron-right"></i>方法
    </a>
  </li>

  <li class="level_3">
    <a href="#index_类" title="类">
      <i class="icon-chevron-right"></i>类
    </a>
  </li>

  <li class="level_3">
    <a href="#index_模块" title="模块">
      <i class="icon-chevron-right"></i>模块
    </a>
  </li>

  <li class="level_2">
    <a href="#index_注释" title="注释">
      <i class="icon-chevron-right"></i>注释
    </a>
  </li>

  <li class="level_2">
    <a href="#index_文件名" title="文件名">
      <i class="icon-chevron-right"></i>文件名
    </a>
  </li>

  <li class="level_2">
    <a href="#index_文件内容" title="文件内容">
      <i class="icon-chevron-right"></i>文件内容
    </a>
  </li>

  <li class="level_3">
    <a href="#index_换行符" title="换行符">
      <i class="icon-chevron-right"></i>换行符
    </a>
  </li>

  <li class="level_3">
    <a href="#index_文件编码" title="文件编码">
      <i class="icon-chevron-right"></i>文件编码
    </a>
  </li>

  <li class="level_2">
    <a href="#index_JSLint扫描代码" title="JSLint扫描代码">
      <i class="icon-chevron-right"></i>JSLint扫描代码
    </a>
  </li>

  <li class="level_2">
    <a href="#index_目录结构说明" title="目录结构说明">
      <i class="icon-chevron-right"></i>目录结构说明
    </a>
  </li>

  <li class="level_2">
    <a href="#index_单元测试" title="单元测试">
      <i class="icon-chevron-right"></i>单元测试
    </a>
  </li>

  <li class="level_2">
    <a href="#index_数据格式" title="数据格式">
      <i class="icon-chevron-right"></i>数据格式
    </a>
  </li>

  <li class="level_2">
    <a href="#index_事件注入" title="事件注入">
      <i class="icon-chevron-right"></i>事件注入
    </a>
  </li>

  <li class="level_2">
    <a href="#index_常见错误" title="常见错误">
      <i class="icon-chevron-right"></i>常见错误
    </a>
  </li>

  <li class="level_3">
    <a href="#index_判断一个对象是否是数组" title="判断一个对象是否是数组">
      <i class="icon-chevron-right"></i>判断一个对象是否是数组
    </a>
  </li>

  <li class="level_3">
    <a href="#index_数组去重" title="数组去重">
      <i class="icon-chevron-right"></i>数组去重
    </a>
  </li>

  <li class="level_3">
    <a href="#index_元素是否存在数组中" title="元素是否存在数组中">
      <i class="icon-chevron-right"></i>元素是否存在数组中
    </a>
  </li>

  <li class="level_3">
    <a href="#index_meta" title="meta">
      <i class="icon-chevron-right"></i>meta
    </a>
  </li>

  <li class="level_3">
    <a href="#index_script标签的type属性" title="script标签的type属性">
      <i class="icon-chevron-right"></i>script标签的type属性
    </a>
  </li>

</ul>

    </div>
    <div class="span9">
      <section>
        <h1>DataV项目编码规范</h1>
<p>一套良好的编码规范如果在团队开发中被遵守，可以降低团队成员之间交流的成本，同时也降低犯错的几率。可以说编码规范只需花费20%的精力来遵循，却可以降低80%的犯低级错误几率。
这一版的编码规范，主要查考了Douglas Crockford的JSLint的检查条件和过去的一些编码经验，整理而出。

</p>
<h2>命名空间</h2>
<p>项目的总命名空间为：<strong><code>DataV</code></strong>。<br>除了Rapheal和D3自身的代码外，我们提交的任何方法都应该挂载在<code>DataV</code>命名空间中。
例外：某些方法和功能可以独立抽取出来，适用于别的项目。但是也应该由一个命名空间来管理它们。

</p>
<h2>语法</h2>
<h3>缩进规范</h3>
<p>由于该项目是普通的前端JavaScript项目，所以缩进采用4个空格的方式。禁止使用tab符号。
推荐更改编辑器中的设置，使得按tab键可以自动插入4个空格。
每一层级之间，要保证缩进是正确的。
</p>
<h3>空格</h3>
<ul>
<li><code>=</code>前后应该存在一个空格</li>
<li><code>(</code>前面应该存在一个空格</li>
<li><code>)</code>后面应该存在一个空格</li>
<li><code>{</code>前面应该存在一个空格</li>
</ul>
<h3>分号</h3>
<p>每一个申明或者定义，都应该以分号结尾。

</p>
<pre><code>var username = &quot;Jackson&quot;;

var foo = function () {};</code></pre>
<p>每一行调用都应该明确以分号结尾。

</p>
<pre><code>foo();</code></pre>
<h3>大括号</h3>
<p>请明确使用<code>{}</code>来约束代码段。
推荐：

</p>
<pre><code>if (condition) {
    foo = &quot;bar&quot;;
}</code></pre>
<p>不推荐：

</p>
<pre><code>if (condition) boo = &quot;bar&quot;;</code></pre>
<h2>命名规范</h2>
<h3>变量</h3>
<p>采用驼峰首字母小写，后续单词均需大写首字母，不得在中间包含下划线。
每一个变量都应该通过<code>var</code>申明，以防止变量污染。
正确:

</p>
<pre><code>var pipeChart;</code></pre>
<p>错误：

</p>
<pre><code>var pipechart;
var pipe_chart;</code></pre>
<h3>方法</h3>
<p>方法名同变量名，采用驼峰式命名。
定义方法均通过<code>var foo = function () {};</code>而不是<code>function foo () {}</code>。

</p>
<pre><code>var foo = function () {
    // TODO
};</code></pre>
<p>方法名应该可以表示方法的行为和暗示方法的返回值。善用<code>set</code>、<code>get</code>、<code>is</code>、<code>has</code>等方法前缀。

</p>
<h3>类</h3>
<p>由于JavaScript中类和方法的关键字都是<code>function</code>，为了区别两者的混淆，类名的定义通常是大写首字母，以表示它是一个作为类来调用的。

</p>
<pre><code>var Person = function () {
    // TODO
};</code></pre>
<p>类的方法请尽量赋值在<code>prototype</code>属性上，使得通过原型链查找的方式降低内存占用。
类的数据请尽量在构造函数中赋值，以加快执行时的查找速度。

</p>
<pre><code>var Person = function (age) {
    this.age = age; // 在构造函数中赋值数据
};

// 在原型链中设置方法
Person.prototype.getAge = function () {
    return this.age;
};</code></pre>
<p>对于私有方法，在前面添加下划线表示不推荐被外部调用。

</p>
<pre><code>Persion.prototype._sleep = function () {};</code></pre>
<h3>模块</h3>
<p>为了统一规划，我们的类均需通过模块的定义方式，与命名空间结合，以保证环境的干净。

</p>
<pre><code>(function () {
    var private = &quot;I am private&quot;;
    var Person = function () {
        this.username = private;
    };

    DataV.Person = Person;
}());</code></pre>
<h2>注释</h2>
<p>注释对于团队而言是十分重要的，每一个方法都应该包含说明。<br>必选的注释是方法的说明，方法的参数，和一个例子。<br>任何诡异的地方，都应该附有简单的注释来描述它，以提醒后来人注意，以区别对待。

</p>
<pre><code>/**
 * Create chart panel by passin width and height
 * @param {string} type Type name
 * @param {number} width Chart panel&#39;s width value
 * @param {number} height Chart panel&#39;s height value
 * @example
 * createChart(&quot;pipe&quot;, 500, 500);
 */
var createChart = function (type, width, height) {
    // Trick comments
    trickCall();
};</code></pre>
<p>通过<a href="http://code.google.com/p/jsdoc-toolkit/w/list">jsdoc</a>的注释，将利于我们后期导出API文档。

</p>
<h2>文件名（以及目录）</h2>
<p>文件名的方式也是通过驼峰式，但是以下划线分割单词，一律小写单词。如：

</p>
<pre><code>d3.js
child_process.js</code></pre>
<h2>JSLint扫描代码</h2>
<p>JSLint的调用方式如下：

</p>
<pre><code>node precommit.js file</code></pre>
<p>配置方式存放在<code>config.json</code>中。

</p>
<h2>目录结构说明</h2>
<p>目前datav组件库的目录结构如下：

</p>
<pre><code>JacksonTianmatoMacBook-Pro:datav.js jacksontian$ tree -d
.
├── bin
├── deps
├── doc
├── example
├── lib
└── test</code></pre>
<p>其中详细说明一下：

</p>
<ul>
<li><code>bin</code>目录用于存放一些可运行的脚本或者工具，例如<code>jslint</code>。</li>
<li><code>deps</code>目录用于存放项目的依赖文件，其中有<code>raphael</code>和<code>d3</code>的相关文件。</li>
<li><code>doc</code>目录用于用于存放项目的文档，如API生成文档或一些说明文档。</li>
<li><code>example</code>目录存放案例代码。</li>
<li><code>lib</code>目录为组件库具体代码，根据每个图的类型不同，存为对应文件。</li>
<li><code>test</code>目录存放单元测试代码或自动化测试代码。</li>
</ul>
<h2>单元测试</h2>
<p><code>DataV</code>项目采用<a href="http://docs.jquery.com/QUnit"><code>QUnit</code></a>作为测试框架，详细文档请见。<br>简单测试例子：

</p>
<pre><code>// 分模块
module(&quot;DataV&quot;);
// 测试用例
test(&quot;Themes.get&quot;, function () {
    // 单个断言
    equal(DataV.Themes.get(&quot;inexsit&quot;), undefined, &quot;Should get undefined when key is inexsit&quot;);
    equal(DataV.Themes.get(&quot;COLOR_MODE&quot;), &quot;gradient&quot;, &quot;Should get gradient when key is COLOR_MODE&quot;);
    equal(typeof DataV.Themes.get(&quot;COLOR_ARGS&quot;), &quot;object&quot;, &quot;COLOR_ARGS should be an object&quot;);
    equal(DataV.Themes.get(&quot;COLOR_ARGS&quot;).length, 2, &quot;COLOR_ARGS should have two items&quot;);
});</code></pre>
<h2>数据格式</h2>
<p>数据格式统一采用二维表的方式，结构比较类似数据库中的表。列名通过文档详细来描述，写在代码的<a href="http://code.google.com/p/jsdoc-toolkit/w/list">jsdoc</a>的注释中。
标准数据格式例子如下：

</p>
<pre><code>/**
 * 设置数据源
 * Example 举个例字，假设下面的数组表示2个人在一年4个季度的消费。第一个人在4个季度里消费了1、2、3、9元。第二个人消费了3、4、6、3元。
 * [
 *  [1,2,3,9],
 *  [3,4,6,3]
 * ]
 * @param {Array} source 数据源数组.
 */
Stream.prototype.setSource = function (source) {
    // TODO
};</code></pre>
<p>所有的组件库的调用都是相同的接口<code>setSource</code>：

</p>
<pre><code>var stream = new DataV.Stream(&quot;chart&quot;);
stream.setSource(source);
stream.render();</code></pre>
<h2>事件注入</h2>
<p>每一个组件都可能向外提供一些事件钩子，包括DOM事件，或者业务逻辑事件。绑定的方式十分简单：

</p>
<pre><code>stream.on(&quot;click&quot;, function (event) {
  console.log(event);
});

stream.on(&quot;dblclick&quot;, function (event) {
  alert(&quot;double click&quot;);
});

stream.on(&quot;contextmenu&quot;, function (event) {
  alert(&quot;mouse right&quot;);
});</code></pre>
<p>组件的内部实现是通过继承<code>EventProxy</code>提供自定义方式，在创建画布后，就绑定一些必要的事件到画布节点上，然后将事件触发出去。如果用户如上文，侦听了这些业务事件，将会调用执行。

</p>
<pre><code>Stream.prototype.createCanvas = function () {
  var conf = this.defaults;
  this.canvas = Raphael(this.node, conf.width, conf.height);
  this.DOMNode = $(this.canvas.canvas);
  var that = this;
  this.DOMNode.click(function (event) {
    that.trigger(&quot;click&quot;, event);
  });
  this.DOMNode.dblclick(function (event) {
    that.trigger(&quot;dblclick&quot;, event);
  });
  this.DOMNode.bind(&quot;contextmenu&quot;, function (event) {
    that.trigger(&quot;contextmenu&quot;, event);
  });
  this.DOMNode.delegate(&quot;path&quot;, &quot;click&quot;, function (event) {
    that.trigger(&quot;path_click&quot;, event);
  });
};</code></pre>
<h2>常见错误</h2>
<h3>判断一个对象是否是数组</h3>
<p>下面是宁朗写的：

</p>
<pre><code>if (color.constructor !== Array) {
  throw new Error(&quot;The color should be Array&quot;);
}</code></pre>
<p>下面是Underscore的方法：

</p>
<pre><code>_.isArray = nativeIsArray || function(obj) {
  return toString.call(obj) == &#39;[object Array]&#39;;
};</code></pre>
<h3>数组去重</h3>
<pre><code>// make an array&#39;s every element unique by delete other same element 
Array.prototype.uniq = function () {
  var temp = {},
    len = this.length;

  for (var i = 0; i &lt; len; i++) {
    if (typeof temp[this[i]] == &quot;undefined&quot;) {
      temp[this[i]] = 1;
    }
  }
  this.length = 0;
  len = 0;
  for (var i in temp) {
    this[len++] = i;
  }
  return this;
};</code></pre>
<p>这里可以调用underscore的uniq方法即可。节省N行代码量

</p>
<h3>元素是否存在数组中</h3>
<pre><code>//check if a string is in an array
var _strInArray = function (str, array) {
  var i = 0,
    l = 0;
  for (i = 0, l = array.length; i &lt; l; i++) {
    if (array[i] === str) {
      return true;
    }
  }
  return false;
};</code></pre>
<p>换用<code>_.indexOf(array, value)</code>可以节省代码量，且返回值比boolean值更有价值

</p>
<h3>meta</h3>
<pre><code>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot; /&gt;</code></pre>
<p>希望大家潮一点，别在写上面那行代码了。下面的表达方式更简洁，且无任何副作用。

</p>
<pre><code>&lt;meta charset=&quot;utf-8&quot; /&gt;</code></pre>
<h3>script标签的type属性</h3>
  <script type="text/javascript" src="../../deps/d3.js"></script>

<p>如果是默认的text/javascript的话，就可以直接省略掉。变成下面这样子：

</p>
<p>=======
</p>
<h1>DataV项目编码规范</h1>
<p>一套良好的编码规范如果在团队开发中被遵守，可以降低团队成员之间交流的成本，同时也降低犯错的几率。可以说编码规范只需花费20%的精力来遵循，却可以降低80%的犯低级错误几率。
这一版的编码规范，主要查考了Douglas Crockford的JSLint的检查条件和过去的一些编码经验，整理而出。

</p>
<h2>命名空间</h2>
<p>项目的总命名空间为：<strong><code>DataV</code></strong>。<br>除了Rapheal和D3自身的代码外，我们提交的任何方法都应该挂载在<code>DataV</code>命名空间中。
例外：某些方法和功能可以独立抽取出来，适用于别的项目。但是也应该由一个命名空间来管理它们。

</p>
<h2>语法</h2>
<h3>缩进规范</h3>
<p>由于该项目是普通的前端JavaScript项目，所以缩进采用2个空格的方式。禁止使用tab符号。
推荐更改编辑器中的设置，使得按tab键可以自动插入2个空格。
每一层级之间，要保证缩进是正确的。
</p>
<h3>空格</h3>
<ul>
<li><code>=</code>前后应该存在一个空格</li>
<li><code>(</code>前面应该存在一个空格</li>
<li><code>)</code>后面应该存在一个空格</li>
<li><code>{</code>前面应该存在一个空格</li>
</ul>
<h3>分号</h3>
<p>每一个申明或者定义，都应该以分号结尾。

</p>
<pre><code>var username = &quot;Jackson&quot;;

var foo = function () {};</code></pre>
<p>每一行调用都应该明确以分号结尾。

</p>
<pre><code>foo();</code></pre>
<h3>大括号</h3>
<p>请明确使用<code>{}</code>来约束代码段。
推荐：

</p>
<pre><code>if (condition) {
    foo = &quot;bar&quot;;
}</code></pre>
<p>不推荐：

</p>
<pre><code>if (condition) boo = &quot;bar&quot;;</code></pre>
<h2>命名规范</h2>
<h3>变量</h3>
<p>采用驼峰首字母小写，后续单词均需大写首字母，不得在中间包含下划线。
每一个变量都应该通过<code>var</code>申明，以防止变量污染。
正确:

</p>
<pre><code>var pipeChart;</code></pre>
<p>错误：

</p>
<pre><code>var pipechart;
var pipe_chart;</code></pre>
<h3>方法</h3>
<p>方法名同变量名，采用驼峰式命名。
定义方法均通过<code>var foo = function () {};</code>而不是<code>function foo () {}</code>。

</p>
<pre><code>var foo = function () {
    // TODO
};</code></pre>
<p>方法名应该可以表示方法的行为和暗示方法的返回值。善用<code>set</code>、<code>get</code>、<code>is</code>、<code>has</code>等方法前缀。

</p>
<h3>类</h3>
<p>由于JavaScript中类和方法的关键字都是<code>function</code>，为了区别两者的混淆，类名的定义通常是大写首字母，以表示它是一个作为类来调用的。

</p>
<pre><code>var Person = function () {
    // TODO
};</code></pre>
<p>类的方法请尽量赋值在<code>prototype</code>属性上，使得通过原型链查找的方式降低内存占用。
类的数据请尽量在构造函数中赋值，以加快执行时的查找速度。

</p>
<pre><code>var Person = function (age) {
    this.age = age; // 在构造函数中赋值数据
};

// 在原型链中设置方法
Person.prototype.getAge = function () {
    return this.age;
};</code></pre>
<p>对于私有方法，在前面添加下划线表示不推荐被外部调用。

</p>
<pre><code>Persion.prototype._sleep = function () {};</code></pre>
<h3>模块</h3>
<p>为了统一规划，我们的类均需通过模块的定义方式，与命名空间结合，以保证环境的干净。

</p>
<pre><code>(function () {
    var private = &quot;I am private&quot;;
    var Person = function () {
        this.username = private;
    };

    DataV.Person = Person;
}());</code></pre>
<h2>注释</h2>
<p>注释对于团队而言是十分重要的，每一个方法都应该包含说明。<br>必选的注释是方法的说明，方法的参数，和一个例子。<br>任何诡异的地方，都应该附有简单的注释来描述它，以提醒后来人注意，以区别对待。

</p>
<pre><code>/**
 * Create chart panel by passin width and height
 * @param {string} type Type name
 * @param {number} width Chart panel&#39;s width value
 * @param {number} height Chart panel&#39;s height value
 * @example
 * createChart(&quot;pipe&quot;, 500, 500);
 */
var createChart = function (type, width, height) {
    // Trick comments
    trickCall();
};</code></pre>
<p>通过<a href="http://code.google.com/p/jsdoc-toolkit/w/list">jsdoc</a>的注释，将利于我们后期导出API文档。

</p>
<h2>文件名</h2>
<p>文件名的方式也是通过驼峰式，但是以下划线分割单词，一律小写单词。如：

</p>
<pre><code>d3.js
child_process.js</code></pre>
<h2>文件内容</h2>
<h3>换行符</h3>
<p>请用Unix的CRLF换行符
</p>
<h3>文件编码</h3>
<p>请用UTF-8 without BOM作为文件内容的编码

</p>
<h2>JSLint扫描代码</h2>
<p>JSLint的调用方式如下：

</p>
<pre><code>node precommit.js file</code></pre>
<p>配置方式存放在<code>config.json</code>中。

</p>
<h2>目录结构说明</h2>
<p>目前datav组件库的目录结构如下：

</p>
<pre><code>JacksonTianmatoMacBook-Pro:datav.js jacksontian$ tree -d
.
├── bin
├── deps
├── doc
├── example
├── lib
└── test</code></pre>
<p>其中详细说明一下：

</p>
<ul>
<li><code>bin</code>目录用于存放一些可运行的脚本或者工具，例如<code>jslint</code>。</li>
<li><code>deps</code>目录用于存放项目的依赖文件，其中有<code>raphael</code>和<code>d3</code>的相关文件。</li>
<li><code>doc</code>目录用于用于存放项目的文档，如API生成文档或一些说明文档。</li>
<li><code>example</code>目录存放案例代码。</li>
<li><code>lib</code>目录为组件库具体代码，根据每个图的类型不同，存为对应文件。</li>
<li><code>test</code>目录存放单元测试代码或自动化测试代码。</li>
</ul>
<h2>单元测试</h2>
<p><code>DataV</code>项目采用<a href="http://docs.jquery.com/QUnit"><code>QUnit</code></a>作为测试框架，详细文档请见。<br>简单测试例子：

</p>
<pre><code>// 分模块
module(&quot;DataV&quot;);
// 测试用例
test(&quot;Themes.get&quot;, function () {
    // 单个断言
    equal(DataV.Themes.get(&quot;inexsit&quot;), undefined, &quot;Should get undefined when key is inexsit&quot;);
    equal(DataV.Themes.get(&quot;COLOR_MODE&quot;), &quot;gradient&quot;, &quot;Should get gradient when key is COLOR_MODE&quot;);
    equal(typeof DataV.Themes.get(&quot;COLOR_ARGS&quot;), &quot;object&quot;, &quot;COLOR_ARGS should be an object&quot;);
    equal(DataV.Themes.get(&quot;COLOR_ARGS&quot;).length, 2, &quot;COLOR_ARGS should have two items&quot;);
});</code></pre>
<h2>数据格式</h2>
<p>数据格式统一采用二维表的方式，结构比较类似数据库中的表。列名通过文档详细来描述，写在代码的<a href="http://code.google.com/p/jsdoc-toolkit/w/list">jsdoc</a>的注释中。
标准数据格式例子如下：

</p>
<pre><code>/**
 * 设置数据源
 * Example 举个例字，假设下面的数组表示2个人在一年4个季度的消费。第一个人在4个季度里消费了1、2、3、9元。第二个人消费了3、4、6、3元。
 * [
 *  [1,2,3,9],
 *  [3,4,6,3]
 * ]
 * @param {Array} source 数据源数组.
 */
Stream.prototype.setSource = function (source) {
    // TODO
};</code></pre>
<p>所有的组件库的调用都是相同的接口<code>setSource</code>：

</p>
<pre><code>var stream = new DataV.Stream(&quot;chart&quot;);
stream.setSource(source);
stream.render();</code></pre>
<h2>事件注入</h2>
<p>每一个组件都可能向外提供一些事件钩子，包括DOM事件，或者业务逻辑事件。绑定的方式十分简单：

</p>
<pre><code>stream.on(&quot;click&quot;, function (event) {
  console.log(event);
});

stream.on(&quot;dblclick&quot;, function (event) {
  alert(&quot;double click&quot;);
});

stream.on(&quot;contextmenu&quot;, function (event) {
  alert(&quot;mouse right&quot;);
});</code></pre>
<p>组件的内部实现是通过继承<code>EventProxy</code>提供自定义方式，在创建画布后，就绑定一些必要的事件到画布节点上，然后将事件触发出去。如果用户如上文，侦听了这些业务事件，将会调用执行。

</p>
<pre><code>Stream.prototype.createCanvas = function () {
  var conf = this.defaults;
  this.canvas = Raphael(this.node, conf.width, conf.height);
  this.DOMNode = $(this.canvas.canvas);
  var that = this;
  this.DOMNode.click(function (event) {
    that.trigger(&quot;click&quot;, event);
  });
  this.DOMNode.dblclick(function (event) {
    that.trigger(&quot;dblclick&quot;, event);
  });
  this.DOMNode.bind(&quot;contextmenu&quot;, function (event) {
    that.trigger(&quot;contextmenu&quot;, event);
  });
  this.DOMNode.delegate(&quot;path&quot;, &quot;click&quot;, function (event) {
    that.trigger(&quot;path_click&quot;, event);
  });
};</code></pre>
<h2>常见错误</h2>
<h3>判断一个对象是否是数组</h3>
<p>下面是宁朗写的：

</p>
<pre><code>if (color.constructor !== Array) {
  throw new Error(&quot;The color should be Array&quot;);
}</code></pre>
<p>下面是Underscore的方法：

</p>
<pre><code>_.isArray = nativeIsArray || function(obj) {
  return toString.call(obj) == &#39;[object Array]&#39;;
};</code></pre>
<h3>数组去重</h3>
<pre><code>// make an array&#39;s every element unique by delete other same element 
Array.prototype.uniq = function () {
  var temp = {},
    len = this.length;

  for (var i = 0; i &lt; len; i++) {
    if (typeof temp[this[i]] == &quot;undefined&quot;) {
      temp[this[i]] = 1;
    }
  }
  this.length = 0;
  len = 0;
  for (var i in temp) {
    this[len++] = i;
  }
  return this;
};</code></pre>
<p>这里可以调用underscore的uniq方法即可。节省N行代码量

</p>
<h3>元素是否存在数组中</h3>
<pre><code>//check if a string is in an array
var _strInArray = function (str, array) {
  var i = 0,
    l = 0;
  for (i = 0, l = array.length; i &lt; l; i++) {
    if (array[i] === str) {
      return true;
    }
  }
  return false;
};</code></pre>
<p>换用<code>_.indexOf(array, value)</code>可以节省代码量，且返回值比boolean值更有价值

</p>
<h3>meta</h3>
<pre><code>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot; /&gt;</code></pre>
<p>希望大家潮一点，别在写上面那行代码了。下面的表达方式更简洁，且无任何副作用。

</p>
<pre><code>&lt;meta charset=&quot;utf-8&quot; /&gt;</code></pre>
<h3>script标签的type属性</h3>
  <script type="text/javascript" src="../../deps/d3.js"></script>

<p>如果是默认的text/javascript的话，就可以直接省略掉。变成下面这样子：

</p>
  <script src="../../deps/d3.js"></script>
      </section>
    </div>
  </div>
</div>
      <footer class="footer">
        <div class="container">
          <p class="pull-right">
            <a href="#">Back to top</a>
          </p>
          <p>此文档通过doxmate生成。主题借鉴Bootstrap API文档风格，注解基于<a href="https://github.com/visionmedia/dox">Dox</a>。欢迎关注doxmate作者<a href="http://weibo.com/shyvo" target="_blank">@朴灵</a></p>
          <ul class="footer-links">
            <li><a href="https://github.com/visionmedia/dox">Dox主页</a></li>
            <li><a href="http://html5ify.com/doxmate">Doxmate主页</a></li>
            <li><a href="https://github.com/JacksonTian/doxmate/issues?state=open">提交bug</a></li>
          </ul>
      </div>
    </footer>
    <script>
      $(function() {
        $('pre').addClass('prettyprint');
        $('td pre').removeClass('prettyprint');
        prettyPrint();
        var $window = $(window);
        $('.bs-docs-sidenav').affix({
          offset: {
            top: function () {
              return $window.width() <= 980 ? 290 : 210
            },
            bottom: 270
          }
        });
        $(".content").find('h1, h2, h3, h4, h5, h6').each(function () {
          var node = $(this);
          if (!node.attr("id")) {
            node.attr("id", "index_" + node.text());
          }
          node.css("paddingTop", 40);
        });
      });
    </script>
  
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-17170593-4']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  
  </body>
</html>